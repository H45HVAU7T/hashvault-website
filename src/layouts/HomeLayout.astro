---
import "../styles/global.css";
import "@fontsource/archivo-black";
import "@fontsource-variable/geist-mono";
import { Image } from "astro:assets";
import background from "@/assets/background.png";
---

<!doctype html>
<html lang="en h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <meta name="theme-color" content="#0d0b0e" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2/src/bold/style.css"
    />
    <title>Hashvault</title>
  </head>
  <body
    class="bg-hash-black relative h-full p-2 text-white lg:min-h-screen xl:p-4"
    style="min-height: 100dvh;"
  >
    {/* Background image */}
    <Image
      id="parallax-bg"
      src={background}
      alt=""
      format="avif"
      quality="high"
      width={background.width}
      priority
      class="pointer-events-none absolute inset-0 -z-10 h-full w-full object-cover transition-transform duration-75 will-change-transform"
    />

    {/* Content container */}
    <div class="border-hash-purple flex min-h-full flex-col border-2">
      <slot />
    </div>
    <script is:inline>
      if (window.matchMedia("(min-width: 1024px)").matches) {
        // Wait for DOM to be fully loaded
        function initParallax() {
          const img = document.getElementById("parallax-bg");

          if (!img) {
            console.error("Parallax background image not found");
            return;
          }

          console.log("Parallax initialized", img); // Debug log

          // Parallax strength factor (tune between 15â€“40 for intensity)
          const strength = 25;
          let targetX = 0,
            targetY = 0;
          let currentX = 0,
            currentY = 0;

          // Handle mouse move
          window.addEventListener("mousemove", (e) => {
            const { innerWidth, innerHeight } = window;
            const x = (e.clientX - innerWidth / 2) / innerWidth;
            const y = (e.clientY - innerHeight / 2) / innerHeight;
            targetX = x * strength;
            targetY = y * strength;
            console.log("Mouse move:", targetX, targetY); // Debug log
          });

          // Smoothly animate towards target
          function animate() {
            currentX += (targetX - currentX) * 0.1;
            currentY += (targetY - currentY) * 0.1;
            img.style.transform = `scale(1.05) translate(${currentX}px, ${currentY}px)`;
            requestAnimationFrame(animate);
          }

          animate();
        }

        // Try multiple initialization methods
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", initParallax);
        } else {
          // DOM already loaded
          initParallax();
        }
      }
    </script>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
</style>
